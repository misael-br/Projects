data2 <- read.csv("usa_00006.csv")
data1 <- read.csv("nics-firearm-background-checks (1).csv")
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)

install.packages("ggplot2", verbose = T)
install.packages("ggthemes", verbose = T)
install.packages("expss", verbose = T)
install.packages("tidyr")
install.packages("fabricatr", verbose = T)
install.packages("coefplot", verbose = T)
install.packages("RColorBrewer", verbose = T)

#Descriptive stats
summary(data1)
summary(data2)

#Filter out outliers
data2 <- data2 %>% filter(INCTOT < 9999999) %>% filter(INCTOT > 0)
#We only want continental US
data2 <- data2 %>% filter(STATEICP < 83)
#Eliminate redundant columns
data2 <- data2 %>% select(YEAR, STATEICP, SEX, AGE, RACE, HISPAN, EDUC, INCTOT)

#Fixing Race
data2$White <- ifelse(data2$RACE == 1, 1, 0)
data2$Black <- ifelse(data2$RACE == 2, 1, 0)
data2$Native <- ifelse(data2$RACE == 3, 1, 0)
data2$Asian <- ifelse(data2$RACE == 4, 1, ifelse(data2$RACE == 5, 1, ifelse(data2$RACE == 6, 1, 0)))
data2$RACE <- NULL
data2$HISPAN <- ifelse(data2$HISPAN == 0, 0, 1)
data2$fem <- ifelse(data2$SEX == 2, 1, 0)
data2$SEX <- NULL

#Break into yearly datasets
data2002 <- data2 %>% filter(YEAR==2002)
data2003 <- data2 %>% filter(YEAR==2003)
data2004 <- data2 %>% filter(YEAR==2004)
data2005 <- data2 %>% filter(YEAR==2005)
data2006 <- data2 %>% filter(YEAR==2006)
data2007 <- data2 %>% filter(YEAR==2007)
data2008 <- data2 %>% filter(YEAR==2008)
data2009 <- data2 %>% filter(YEAR==2009)
data2010 <- data2 %>% filter(YEAR==2010)
data2011 <- data2 %>% filter(YEAR==2011)
data2012 <- data2 %>% filter(YEAR==2012)
data2013 <- data2 %>% filter(YEAR==2013)
data2014 <- data2 %>% filter(YEAR==2014)
data2015 <- data2 %>% filter(YEAR==2015)
data2016 <- data2 %>% filter(YEAR==2016)
data2017 <- data2 %>% filter(YEAR==2017)
data2018 <- data2 %>% filter(YEAR==2018)
data2019 <- data2 %>% filter(YEAR==2019)

#State numbers to names
data2002$STATEICP <- ifelse(data2002$STATEICP==1, "Connecticut", ifelse(data2002$STATEICP==2, "Maine", ifelse(data2002$STATEICP==3,
                  "Massachusetts", ifelse(data2002$STATEICP==4, "New Hampshire", ifelse(data2002$STATEICP==5, "Rhode Island", 
                  ifelse(data2002$STATEICP==6, "Vermont", ifelse(data2002$STATEICP==11, "Delaware", ifelse(data2002$STATEICP==12,
                  "New Jersey", ifelse(data2002$STATEICP==13, "New York", ifelse(data2002$STATEICP==14, "Pennsylvania", 
                  ifelse(data2002$STATEICP==21, "Illinois", ifelse(data2002$STATEICP==22, "Indiana", ifelse(data2002$STATEICP==23,
                  "Michigan", ifelse(data2002$STATEICP==24, "Ohio", ifelse(data2002$STATEICP==25, "Wisconsin", 
                  ifelse(data2002$STATEICP==31, "Iowa", ifelse(data2002$STATEICP==32, "Kansas", ifelse(data2002$STATEICP==33,
                  "Minnesota", ifelse(data2002$STATEICP==34, "Missouri", ifelse(data2002$STATEICP==35, "Nebraska", 
                  ifelse(data2002$STATEICP==36, "North Dakota", ifelse(data2002$STATEICP==37, "South Dakota", ifelse(data2002$STATEICP==40,
                  "Virginia", ifelse(data2002$STATEICP==41, "Alabama", ifelse(data2002$STATEICP==42, "Arkansas", 
                  ifelse(data2002$STATEICP==43, "Florida", ifelse(data2002$STATEICP==44, "Georgia", ifelse(data2002$STATEICP==45,
                  "Lousiana", ifelse(data2002$STATEICP==46, "Mississippi", ifelse(data2002$STATEICP==47, "North Carolina",
                  ifelse(data2002$STATEICP==48, "South Carolina", ifelse(data2002$STATEICP==49, "Texas", ifelse(data2002$STATEICP==51,
                  "Kentucky", ifelse(data2002$STATEICP==52, "Maryland", ifelse(data2002$STATEICP==53, "Oklahoma",
                  ifelse(data2002$STATEICP==54, "Tennessee", ifelse(data2002$STATEICP==56, "West Virginia", ifelse(data2002$STATEICP==61,
                  "Arizona", ifelse(data2002$STATEICP==62, "Colorado", ifelse(data2002$STATEICP==63, "Idaho",
                  ifelse(data2002$STATEICP==64, "Montana", ifelse(data2002$STATEICP==65, "Nevada", ifelse(data2002$STATEICP==66,
                  "New Mexico", ifelse(data2002$STATEICP==67, "Utah", ifelse(data2002$STATEICP==68, "Wyoming",
                  ifelse(data2002$STATEICP==71, "California", ifelse(data2002$STATEICP==72, "Oregon", ifelse(data2002$STATEICP==73,
                  "Washington", ifelse(data2002$STATEICP==81, "Alaska", ifelse(data2002$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
#Removing any rows that weren't transformed
data2002 <- data2002 %>% filter(STATEICP > 0)

data2003$STATEICP <- ifelse(data2003$STATEICP==1, "Connecticut", ifelse(data2003$STATEICP==2, "Maine", ifelse(data2003$STATEICP==3,
                     "Massachusetts", ifelse(data2003$STATEICP==4, "New Hampshire", ifelse(data2003$STATEICP==5, "Rhode Island", 
                     ifelse(data2003$STATEICP==6, "Vermont", ifelse(data2003$STATEICP==11, "Delaware", ifelse(data2003$STATEICP==12,
                     "New Jersey", ifelse(data2003$STATEICP==13, "New York", ifelse(data2003$STATEICP==14, "Pennsylvania", 
                     ifelse(data2003$STATEICP==21, "Illinois", ifelse(data2003$STATEICP==22, "Indiana", ifelse(data2003$STATEICP==23,
                     "Michigan", ifelse(data2003$STATEICP==24, "Ohio", ifelse(data2003$STATEICP==25, "Wisconsin", 
                     ifelse(data2003$STATEICP==31, "Iowa", ifelse(data2003$STATEICP==32, "Kansas", ifelse(data2003$STATEICP==33,
                     "Minnesota", ifelse(data2003$STATEICP==34, "Missouri", ifelse(data2003$STATEICP==35, "Nebraska", 
                     ifelse(data2003$STATEICP==36, "North Dakota", ifelse(data2003$STATEICP==37, "South Dakota", ifelse(data2003$STATEICP==40,
                     "Virginia", ifelse(data2003$STATEICP==41, "Alabama", ifelse(data2003$STATEICP==42, "Arkansas", 
                     ifelse(data2003$STATEICP==43, "Florida", ifelse(data2003$STATEICP==44, "Georgia", ifelse(data2003$STATEICP==45,
                     "Lousiana", ifelse(data2003$STATEICP==46, "Mississippi", ifelse(data2003$STATEICP==47, "North Carolina",
                     ifelse(data2003$STATEICP==48, "South Carolina", ifelse(data2003$STATEICP==49, "Texas", ifelse(data2003$STATEICP==51,
                     "Kentucky", ifelse(data2003$STATEICP==52, "Maryland", ifelse(data2003$STATEICP==53, "Oklahoma",
                     ifelse(data2003$STATEICP==54, "Tennessee", ifelse(data2003$STATEICP==56, "West Virginia", ifelse(data2003$STATEICP==61,
                     "Arizona", ifelse(data2003$STATEICP==62, "Colorado", ifelse(data2003$STATEICP==63, "Idaho",
                     ifelse(data2003$STATEICP==64, "Montana", ifelse(data2003$STATEICP==65, "Nevada", ifelse(data2003$STATEICP==66,
                     "New Mexico", ifelse(data2003$STATEICP==67, "Utah", ifelse(data2003$STATEICP==68, "Wyoming",
                     ifelse(data2003$STATEICP==71, "California", ifelse(data2003$STATEICP==72, "Oregon", ifelse(data2003$STATEICP==73,
                     "Washington", ifelse(data2003$STATEICP==81, "Alaska", ifelse(data2003$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2003 <- data2003 %>% filter(STATEICP > 0)

data2004$STATEICP <- ifelse(data2004$STATEICP==1, "Connecticut", ifelse(data2004$STATEICP==2, "Maine", ifelse(data2004$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2004$STATEICP==4, "New Hampshire", ifelse(data2004$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2004$STATEICP==6, "Vermont", ifelse(data2004$STATEICP==11, "Delaware", ifelse(data2004$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2004$STATEICP==13, "New York", ifelse(data2004$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2004$STATEICP==21, "Illinois", ifelse(data2004$STATEICP==22, "Indiana", ifelse(data2004$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2004$STATEICP==24, "Ohio", ifelse(data2004$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2004$STATEICP==31, "Iowa", ifelse(data2004$STATEICP==32, "Kansas", ifelse(data2004$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2004$STATEICP==34, "Missouri", ifelse(data2004$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2004$STATEICP==36, "North Dakota", ifelse(data2004$STATEICP==37, "South Dakota", ifelse(data2004$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2004$STATEICP==41, "Alabama", ifelse(data2004$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2004$STATEICP==43, "Florida", ifelse(data2004$STATEICP==44, "Georgia", ifelse(data2004$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2004$STATEICP==46, "Mississippi", ifelse(data2004$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2004$STATEICP==48, "South Carolina", ifelse(data2004$STATEICP==49, "Texas", ifelse(data2004$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2004$STATEICP==52, "Maryland", ifelse(data2004$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2004$STATEICP==54, "Tennessee", ifelse(data2004$STATEICP==56, "West Virginia", ifelse(data2004$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2004$STATEICP==62, "Colorado", ifelse(data2004$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2004$STATEICP==64, "Montana", ifelse(data2004$STATEICP==65, "Nevada", ifelse(data2004$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2004$STATEICP==67, "Utah", ifelse(data2004$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2004$STATEICP==71, "California", ifelse(data2004$STATEICP==72, "Oregon", ifelse(data2004$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2004$STATEICP==81, "Alaska", ifelse(data2004$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2004 <- data2004 %>% filter(STATEICP > 0)


data2005$STATEICP <- ifelse(data2005$STATEICP==1, "Connecticut", ifelse(data2005$STATEICP==2, "Maine", ifelse(data2005$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2005$STATEICP==4, "New Hampshire", ifelse(data2005$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2005$STATEICP==6, "Vermont", ifelse(data2005$STATEICP==11, "Delaware", ifelse(data2005$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2005$STATEICP==13, "New York", ifelse(data2005$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2005$STATEICP==21, "Illinois", ifelse(data2005$STATEICP==22, "Indiana", ifelse(data2005$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2005$STATEICP==24, "Ohio", ifelse(data2005$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2005$STATEICP==31, "Iowa", ifelse(data2005$STATEICP==32, "Kansas", ifelse(data2005$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2005$STATEICP==34, "Missouri", ifelse(data2005$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2005$STATEICP==36, "North Dakota", ifelse(data2005$STATEICP==37, "South Dakota", ifelse(data2005$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2005$STATEICP==41, "Alabama", ifelse(data2005$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2005$STATEICP==43, "Florida", ifelse(data2005$STATEICP==44, "Georgia", ifelse(data2005$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2005$STATEICP==46, "Mississippi", ifelse(data2005$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2005$STATEICP==48, "South Carolina", ifelse(data2005$STATEICP==49, "Texas", ifelse(data2005$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2005$STATEICP==52, "Maryland", ifelse(data2005$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2005$STATEICP==54, "Tennessee", ifelse(data2005$STATEICP==56, "West Virginia", ifelse(data2005$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2005$STATEICP==62, "Colorado", ifelse(data2005$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2005$STATEICP==64, "Montana", ifelse(data2005$STATEICP==65, "Nevada", ifelse(data2005$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2005$STATEICP==67, "Utah", ifelse(data2005$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2005$STATEICP==71, "California", ifelse(data2005$STATEICP==72, "Oregon", ifelse(data2005$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2005$STATEICP==81, "Alaska", ifelse(data2005$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2005 <- data2005 %>% filter(STATEICP > 0)

data2006$STATEICP <- ifelse(data2006$STATEICP==1, "Connecticut", ifelse(data2006$STATEICP==2, "Maine", ifelse(data2006$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2006$STATEICP==4, "New Hampshire", ifelse(data2006$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2006$STATEICP==6, "Vermont", ifelse(data2006$STATEICP==11, "Delaware", ifelse(data2006$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2006$STATEICP==13, "New York", ifelse(data2006$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2006$STATEICP==21, "Illinois", ifelse(data2006$STATEICP==22, "Indiana", ifelse(data2006$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2006$STATEICP==24, "Ohio", ifelse(data2006$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2006$STATEICP==31, "Iowa", ifelse(data2006$STATEICP==32, "Kansas", ifelse(data2006$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2006$STATEICP==34, "Missouri", ifelse(data2006$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2006$STATEICP==36, "North Dakota", ifelse(data2006$STATEICP==37, "South Dakota", ifelse(data2006$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2006$STATEICP==41, "Alabama", ifelse(data2006$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2006$STATEICP==43, "Florida", ifelse(data2006$STATEICP==44, "Georgia", ifelse(data2006$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2006$STATEICP==46, "Mississippi", ifelse(data2006$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2006$STATEICP==48, "South Carolina", ifelse(data2006$STATEICP==49, "Texas", ifelse(data2006$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2006$STATEICP==52, "Maryland", ifelse(data2006$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2006$STATEICP==54, "Tennessee", ifelse(data2006$STATEICP==56, "West Virginia", ifelse(data2006$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2006$STATEICP==62, "Colorado", ifelse(data2006$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2006$STATEICP==64, "Montana", ifelse(data2006$STATEICP==65, "Nevada", ifelse(data2006$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2006$STATEICP==67, "Utah", ifelse(data2006$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2006$STATEICP==71, "California", ifelse(data2006$STATEICP==72, "Oregon", ifelse(data2006$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2006$STATEICP==81, "Alaska", ifelse(data2006$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2006 <- data2006 %>% filter(STATEICP > 0)

data2007$STATEICP <- ifelse(data2007$STATEICP==1, "Connecticut", ifelse(data2007$STATEICP==2, "Maine", ifelse(data2007$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2007$STATEICP==4, "New Hampshire", ifelse(data2007$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2007$STATEICP==6, "Vermont", ifelse(data2007$STATEICP==11, "Delaware", ifelse(data2007$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2007$STATEICP==13, "New York", ifelse(data2007$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2007$STATEICP==21, "Illinois", ifelse(data2007$STATEICP==22, "Indiana", ifelse(data2007$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2007$STATEICP==24, "Ohio", ifelse(data2007$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2007$STATEICP==31, "Iowa", ifelse(data2007$STATEICP==32, "Kansas", ifelse(data2007$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2007$STATEICP==34, "Missouri", ifelse(data2007$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2007$STATEICP==36, "North Dakota", ifelse(data2007$STATEICP==37, "South Dakota", ifelse(data2007$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2007$STATEICP==41, "Alabama", ifelse(data2007$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2007$STATEICP==43, "Florida", ifelse(data2007$STATEICP==44, "Georgia", ifelse(data2007$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2007$STATEICP==46, "Mississippi", ifelse(data2007$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2007$STATEICP==48, "South Carolina", ifelse(data2007$STATEICP==49, "Texas", ifelse(data2007$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2007$STATEICP==52, "Maryland", ifelse(data2007$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2007$STATEICP==54, "Tennessee", ifelse(data2007$STATEICP==56, "West Virginia", ifelse(data2007$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2007$STATEICP==62, "Colorado", ifelse(data2007$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2007$STATEICP==64, "Montana", ifelse(data2007$STATEICP==65, "Nevada", ifelse(data2007$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2007$STATEICP==67, "Utah", ifelse(data2007$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2007$STATEICP==71, "California", ifelse(data2007$STATEICP==72, "Oregon", ifelse(data2007$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2007$STATEICP==81, "Alaska", ifelse(data2007$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2007 <- data2007 %>% filter(STATEICP > 0)

data2008$STATEICP <- ifelse(data2008$STATEICP==1, "Connecticut", ifelse(data2008$STATEICP==2, "Maine", ifelse(data2008$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2008$STATEICP==4, "New Hampshire", ifelse(data2008$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2008$STATEICP==6, "Vermont", ifelse(data2008$STATEICP==11, "Delaware", ifelse(data2008$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2008$STATEICP==13, "New York", ifelse(data2008$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2008$STATEICP==21, "Illinois", ifelse(data2008$STATEICP==22, "Indiana", ifelse(data2008$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2008$STATEICP==24, "Ohio", ifelse(data2008$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2008$STATEICP==31, "Iowa", ifelse(data2008$STATEICP==32, "Kansas", ifelse(data2008$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2008$STATEICP==34, "Missouri", ifelse(data2008$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2008$STATEICP==36, "North Dakota", ifelse(data2008$STATEICP==37, "South Dakota", ifelse(data2008$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2008$STATEICP==41, "Alabama", ifelse(data2008$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2008$STATEICP==43, "Florida", ifelse(data2008$STATEICP==44, "Georgia", ifelse(data2008$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2008$STATEICP==46, "Mississippi", ifelse(data2008$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2008$STATEICP==48, "South Carolina", ifelse(data2008$STATEICP==49, "Texas", ifelse(data2008$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2008$STATEICP==52, "Maryland", ifelse(data2008$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2008$STATEICP==54, "Tennessee", ifelse(data2008$STATEICP==56, "West Virginia", ifelse(data2008$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2008$STATEICP==62, "Colorado", ifelse(data2008$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2008$STATEICP==64, "Montana", ifelse(data2008$STATEICP==65, "Nevada", ifelse(data2008$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2008$STATEICP==67, "Utah", ifelse(data2008$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2008$STATEICP==71, "California", ifelse(data2008$STATEICP==72, "Oregon", ifelse(data2008$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2008$STATEICP==81, "Alaska", ifelse(data2008$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2008 <- data2008 %>% filter(STATEICP > 0)

data2009$STATEICP <- ifelse(data2009$STATEICP==1, "Connecticut", ifelse(data2009$STATEICP==2, "Maine", ifelse(data2009$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2009$STATEICP==4, "New Hampshire", ifelse(data2009$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2009$STATEICP==6, "Vermont", ifelse(data2009$STATEICP==11, "Delaware", ifelse(data2009$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2009$STATEICP==13, "New York", ifelse(data2009$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2009$STATEICP==21, "Illinois", ifelse(data2009$STATEICP==22, "Indiana", ifelse(data2009$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2009$STATEICP==24, "Ohio", ifelse(data2009$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2009$STATEICP==31, "Iowa", ifelse(data2009$STATEICP==32, "Kansas", ifelse(data2009$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2009$STATEICP==34, "Missouri", ifelse(data2009$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2009$STATEICP==36, "North Dakota", ifelse(data2009$STATEICP==37, "South Dakota", ifelse(data2009$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2009$STATEICP==41, "Alabama", ifelse(data2009$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2009$STATEICP==43, "Florida", ifelse(data2009$STATEICP==44, "Georgia", ifelse(data2009$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2009$STATEICP==46, "Mississippi", ifelse(data2009$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2009$STATEICP==48, "South Carolina", ifelse(data2009$STATEICP==49, "Texas", ifelse(data2009$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2009$STATEICP==52, "Maryland", ifelse(data2009$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2009$STATEICP==54, "Tennessee", ifelse(data2009$STATEICP==56, "West Virginia", ifelse(data2009$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2009$STATEICP==62, "Colorado", ifelse(data2009$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2009$STATEICP==64, "Montana", ifelse(data2009$STATEICP==65, "Nevada", ifelse(data2009$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2009$STATEICP==67, "Utah", ifelse(data2009$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2009$STATEICP==71, "California", ifelse(data2009$STATEICP==72, "Oregon", ifelse(data2009$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2009$STATEICP==81, "Alaska", ifelse(data2009$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2009 <- data2009 %>% filter(STATEICP > 0)

data2010$STATEICP <- ifelse(data2010$STATEICP==1, "Connecticut", ifelse(data2010$STATEICP==2, "Maine", ifelse(data2010$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2010$STATEICP==4, "New Hampshire", ifelse(data2010$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2010$STATEICP==6, "Vermont", ifelse(data2010$STATEICP==11, "Delaware", ifelse(data2010$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2010$STATEICP==13, "New York", ifelse(data2010$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2010$STATEICP==21, "Illinois", ifelse(data2010$STATEICP==22, "Indiana", ifelse(data2010$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2010$STATEICP==24, "Ohio", ifelse(data2010$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2010$STATEICP==31, "Iowa", ifelse(data2010$STATEICP==32, "Kansas", ifelse(data2010$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2010$STATEICP==34, "Missouri", ifelse(data2010$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2010$STATEICP==36, "North Dakota", ifelse(data2010$STATEICP==37, "South Dakota", ifelse(data2010$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2010$STATEICP==41, "Alabama", ifelse(data2010$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2010$STATEICP==43, "Florida", ifelse(data2010$STATEICP==44, "Georgia", ifelse(data2010$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2010$STATEICP==46, "Mississippi", ifelse(data2010$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2010$STATEICP==48, "South Carolina", ifelse(data2010$STATEICP==49, "Texas", ifelse(data2010$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2010$STATEICP==52, "Maryland", ifelse(data2010$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2010$STATEICP==54, "Tennessee", ifelse(data2010$STATEICP==56, "West Virginia", ifelse(data2010$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2010$STATEICP==62, "Colorado", ifelse(data2010$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2010$STATEICP==64, "Montana", ifelse(data2010$STATEICP==65, "Nevada", ifelse(data2010$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2010$STATEICP==67, "Utah", ifelse(data2010$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2010$STATEICP==71, "California", ifelse(data2010$STATEICP==72, "Oregon", ifelse(data2010$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2010$STATEICP==81, "Alaska", ifelse(data2010$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2010 <- data2010 %>% filter(STATEICP > 0)

data2011$STATEICP <- ifelse(data2011$STATEICP==1, "Connecticut", ifelse(data2011$STATEICP==2, "Maine", ifelse(data2011$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2011$STATEICP==4, "New Hampshire", ifelse(data2011$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2011$STATEICP==6, "Vermont", ifelse(data2011$STATEICP==11, "Delaware", ifelse(data2011$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2011$STATEICP==13, "New York", ifelse(data2011$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2011$STATEICP==21, "Illinois", ifelse(data2011$STATEICP==22, "Indiana", ifelse(data2011$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2011$STATEICP==24, "Ohio", ifelse(data2011$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2011$STATEICP==31, "Iowa", ifelse(data2011$STATEICP==32, "Kansas", ifelse(data2011$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2011$STATEICP==34, "Missouri", ifelse(data2011$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2011$STATEICP==36, "North Dakota", ifelse(data2011$STATEICP==37, "South Dakota", ifelse(data2011$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2011$STATEICP==41, "Alabama", ifelse(data2011$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2011$STATEICP==43, "Florida", ifelse(data2011$STATEICP==44, "Georgia", ifelse(data2011$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2011$STATEICP==46, "Mississippi", ifelse(data2011$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2011$STATEICP==48, "South Carolina", ifelse(data2011$STATEICP==49, "Texas", ifelse(data2011$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2011$STATEICP==52, "Maryland", ifelse(data2011$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2011$STATEICP==54, "Tennessee", ifelse(data2011$STATEICP==56, "West Virginia", ifelse(data2011$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2011$STATEICP==62, "Colorado", ifelse(data2011$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2011$STATEICP==64, "Montana", ifelse(data2011$STATEICP==65, "Nevada", ifelse(data2011$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2011$STATEICP==67, "Utah", ifelse(data2011$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2011$STATEICP==71, "California", ifelse(data2011$STATEICP==72, "Oregon", ifelse(data2011$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2011$STATEICP==81, "Alaska", ifelse(data2011$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2011 <- data2011 %>% filter(STATEICP > 0)

data2012$STATEICP <- ifelse(data2012$STATEICP==1, "Connecticut", ifelse(data2012$STATEICP==2, "Maine", ifelse(data2012$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2012$STATEICP==4, "New Hampshire", ifelse(data2012$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2012$STATEICP==6, "Vermont", ifelse(data2012$STATEICP==11, "Delaware", ifelse(data2012$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2012$STATEICP==13, "New York", ifelse(data2012$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2012$STATEICP==21, "Illinois", ifelse(data2012$STATEICP==22, "Indiana", ifelse(data2012$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2012$STATEICP==24, "Ohio", ifelse(data2012$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2012$STATEICP==31, "Iowa", ifelse(data2012$STATEICP==32, "Kansas", ifelse(data2012$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2012$STATEICP==34, "Missouri", ifelse(data2012$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2012$STATEICP==36, "North Dakota", ifelse(data2012$STATEICP==37, "South Dakota", ifelse(data2012$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2012$STATEICP==41, "Alabama", ifelse(data2012$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2012$STATEICP==43, "Florida", ifelse(data2012$STATEICP==44, "Georgia", ifelse(data2012$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2012$STATEICP==46, "Mississippi", ifelse(data2012$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2012$STATEICP==48, "South Carolina", ifelse(data2012$STATEICP==49, "Texas", ifelse(data2012$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2012$STATEICP==52, "Maryland", ifelse(data2012$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2012$STATEICP==54, "Tennessee", ifelse(data2012$STATEICP==56, "West Virginia", ifelse(data2012$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2012$STATEICP==62, "Colorado", ifelse(data2012$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2012$STATEICP==64, "Montana", ifelse(data2012$STATEICP==65, "Nevada", ifelse(data2012$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2012$STATEICP==67, "Utah", ifelse(data2012$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2012$STATEICP==71, "California", ifelse(data2012$STATEICP==72, "Oregon", ifelse(data2012$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2012$STATEICP==81, "Alaska", ifelse(data2012$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2012 <- data2012 %>% filter(STATEICP > 0)

data2013$STATEICP <- ifelse(data2013$STATEICP==1, "Connecticut", ifelse(data2013$STATEICP==2, "Maine", ifelse(data2013$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2013$STATEICP==4, "New Hampshire", ifelse(data2013$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2013$STATEICP==6, "Vermont", ifelse(data2013$STATEICP==11, "Delaware", ifelse(data2013$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2013$STATEICP==13, "New York", ifelse(data2013$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2013$STATEICP==21, "Illinois", ifelse(data2013$STATEICP==22, "Indiana", ifelse(data2013$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2013$STATEICP==24, "Ohio", ifelse(data2013$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2013$STATEICP==31, "Iowa", ifelse(data2013$STATEICP==32, "Kansas", ifelse(data2013$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2013$STATEICP==34, "Missouri", ifelse(data2013$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2013$STATEICP==36, "North Dakota", ifelse(data2013$STATEICP==37, "South Dakota", ifelse(data2013$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2013$STATEICP==41, "Alabama", ifelse(data2013$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2013$STATEICP==43, "Florida", ifelse(data2013$STATEICP==44, "Georgia", ifelse(data2013$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2013$STATEICP==46, "Mississippi", ifelse(data2013$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2013$STATEICP==48, "South Carolina", ifelse(data2013$STATEICP==49, "Texas", ifelse(data2013$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2013$STATEICP==52, "Maryland", ifelse(data2013$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2013$STATEICP==54, "Tennessee", ifelse(data2013$STATEICP==56, "West Virginia", ifelse(data2013$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2013$STATEICP==62, "Colorado", ifelse(data2013$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2013$STATEICP==64, "Montana", ifelse(data2013$STATEICP==65, "Nevada", ifelse(data2013$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2013$STATEICP==67, "Utah", ifelse(data2013$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2013$STATEICP==71, "California", ifelse(data2013$STATEICP==72, "Oregon", ifelse(data2013$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2013$STATEICP==81, "Alaska", ifelse(data2013$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2013 <- data2013 %>% filter(STATEICP > 0)

data2014$STATEICP <- ifelse(data2014$STATEICP==1, "Connecticut", ifelse(data2014$STATEICP==2, "Maine", ifelse(data2014$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2014$STATEICP==4, "New Hampshire", ifelse(data2014$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2014$STATEICP==6, "Vermont", ifelse(data2014$STATEICP==11, "Delaware", ifelse(data2014$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2014$STATEICP==13, "New York", ifelse(data2014$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2014$STATEICP==21, "Illinois", ifelse(data2014$STATEICP==22, "Indiana", ifelse(data2014$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2014$STATEICP==24, "Ohio", ifelse(data2014$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2014$STATEICP==31, "Iowa", ifelse(data2014$STATEICP==32, "Kansas", ifelse(data2014$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2014$STATEICP==34, "Missouri", ifelse(data2014$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2014$STATEICP==36, "North Dakota", ifelse(data2014$STATEICP==37, "South Dakota", ifelse(data2014$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2014$STATEICP==41, "Alabama", ifelse(data2014$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2014$STATEICP==43, "Florida", ifelse(data2014$STATEICP==44, "Georgia", ifelse(data2014$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2014$STATEICP==46, "Mississippi", ifelse(data2014$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2014$STATEICP==48, "South Carolina", ifelse(data2014$STATEICP==49, "Texas", ifelse(data2014$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2014$STATEICP==52, "Maryland", ifelse(data2014$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2014$STATEICP==54, "Tennessee", ifelse(data2014$STATEICP==56, "West Virginia", ifelse(data2014$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2014$STATEICP==62, "Colorado", ifelse(data2014$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2014$STATEICP==64, "Montana", ifelse(data2014$STATEICP==65, "Nevada", ifelse(data2014$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2014$STATEICP==67, "Utah", ifelse(data2014$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2014$STATEICP==71, "California", ifelse(data2014$STATEICP==72, "Oregon", ifelse(data2014$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2014$STATEICP==81, "Alaska", ifelse(data2014$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2014 <- data2014 %>% filter(STATEICP > 0)

data2015$STATEICP <- ifelse(data2015$STATEICP==1, "Connecticut", ifelse(data2015$STATEICP==2, "Maine", ifelse(data2015$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2015$STATEICP==4, "New Hampshire", ifelse(data2015$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2015$STATEICP==6, "Vermont", ifelse(data2015$STATEICP==11, "Delaware", ifelse(data2015$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2015$STATEICP==13, "New York", ifelse(data2015$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2015$STATEICP==21, "Illinois", ifelse(data2015$STATEICP==22, "Indiana", ifelse(data2015$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2015$STATEICP==24, "Ohio", ifelse(data2015$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2015$STATEICP==31, "Iowa", ifelse(data2015$STATEICP==32, "Kansas", ifelse(data2015$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2015$STATEICP==34, "Missouri", ifelse(data2015$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2015$STATEICP==36, "North Dakota", ifelse(data2015$STATEICP==37, "South Dakota", ifelse(data2015$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2015$STATEICP==41, "Alabama", ifelse(data2015$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2015$STATEICP==43, "Florida", ifelse(data2015$STATEICP==44, "Georgia", ifelse(data2015$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2015$STATEICP==46, "Mississippi", ifelse(data2015$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2015$STATEICP==48, "South Carolina", ifelse(data2015$STATEICP==49, "Texas", ifelse(data2015$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2015$STATEICP==52, "Maryland", ifelse(data2015$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2015$STATEICP==54, "Tennessee", ifelse(data2015$STATEICP==56, "West Virginia", ifelse(data2015$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2015$STATEICP==62, "Colorado", ifelse(data2015$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2015$STATEICP==64, "Montana", ifelse(data2015$STATEICP==65, "Nevada", ifelse(data2015$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2015$STATEICP==67, "Utah", ifelse(data2015$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2015$STATEICP==71, "California", ifelse(data2015$STATEICP==72, "Oregon", ifelse(data2015$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2015$STATEICP==81, "Alaska", ifelse(data2015$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2015 <- data2015 %>% filter(STATEICP > 0)

data2016$STATEICP <- ifelse(data2016$STATEICP==1, "Connecticut", ifelse(data2016$STATEICP==2, "Maine", ifelse(data2016$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2016$STATEICP==4, "New Hampshire", ifelse(data2016$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2016$STATEICP==6, "Vermont", ifelse(data2016$STATEICP==11, "Delaware", ifelse(data2016$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2016$STATEICP==13, "New York", ifelse(data2016$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2016$STATEICP==21, "Illinois", ifelse(data2016$STATEICP==22, "Indiana", ifelse(data2016$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2016$STATEICP==24, "Ohio", ifelse(data2016$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2016$STATEICP==31, "Iowa", ifelse(data2016$STATEICP==32, "Kansas", ifelse(data2016$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2016$STATEICP==34, "Missouri", ifelse(data2016$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2016$STATEICP==36, "North Dakota", ifelse(data2016$STATEICP==37, "South Dakota", ifelse(data2016$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2016$STATEICP==41, "Alabama", ifelse(data2016$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2016$STATEICP==43, "Florida", ifelse(data2016$STATEICP==44, "Georgia", ifelse(data2016$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2016$STATEICP==46, "Mississippi", ifelse(data2016$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2016$STATEICP==48, "South Carolina", ifelse(data2016$STATEICP==49, "Texas", ifelse(data2016$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2016$STATEICP==52, "Maryland", ifelse(data2016$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2016$STATEICP==54, "Tennessee", ifelse(data2016$STATEICP==56, "West Virginia", ifelse(data2016$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2016$STATEICP==62, "Colorado", ifelse(data2016$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2016$STATEICP==64, "Montana", ifelse(data2016$STATEICP==65, "Nevada", ifelse(data2016$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2016$STATEICP==67, "Utah", ifelse(data2016$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2016$STATEICP==71, "California", ifelse(data2016$STATEICP==72, "Oregon", ifelse(data2016$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2016$STATEICP==81, "Alaska", ifelse(data2016$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2016 <- data2016 %>% filter(STATEICP > 0)

data2017$STATEICP <- ifelse(data2017$STATEICP==1, "Connecticut", ifelse(data2017$STATEICP==2, "Maine", ifelse(data2017$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2017$STATEICP==4, "New Hampshire", ifelse(data2017$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2017$STATEICP==6, "Vermont", ifelse(data2017$STATEICP==11, "Delaware", ifelse(data2017$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2017$STATEICP==13, "New York", ifelse(data2017$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2017$STATEICP==21, "Illinois", ifelse(data2017$STATEICP==22, "Indiana", ifelse(data2017$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2017$STATEICP==24, "Ohio", ifelse(data2017$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2017$STATEICP==31, "Iowa", ifelse(data2017$STATEICP==32, "Kansas", ifelse(data2017$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2017$STATEICP==34, "Missouri", ifelse(data2017$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2017$STATEICP==36, "North Dakota", ifelse(data2017$STATEICP==37, "South Dakota", ifelse(data2017$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2017$STATEICP==41, "Alabama", ifelse(data2017$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2017$STATEICP==43, "Florida", ifelse(data2017$STATEICP==44, "Georgia", ifelse(data2017$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2017$STATEICP==46, "Mississippi", ifelse(data2017$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2017$STATEICP==48, "South Carolina", ifelse(data2017$STATEICP==49, "Texas", ifelse(data2017$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2017$STATEICP==52, "Maryland", ifelse(data2017$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2017$STATEICP==54, "Tennessee", ifelse(data2017$STATEICP==56, "West Virginia", ifelse(data2017$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2017$STATEICP==62, "Colorado", ifelse(data2017$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2017$STATEICP==64, "Montana", ifelse(data2017$STATEICP==65, "Nevada", ifelse(data2017$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2017$STATEICP==67, "Utah", ifelse(data2017$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2017$STATEICP==71, "California", ifelse(data2017$STATEICP==72, "Oregon", ifelse(data2017$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2017$STATEICP==81, "Alaska", ifelse(data2017$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2017 <- data2017 %>% filter(STATEICP > 0)

data2018$STATEICP <- ifelse(data2018$STATEICP==1, "Connecticut", ifelse(data2018$STATEICP==2, "Maine", ifelse(data2018$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2018$STATEICP==4, "New Hampshire", ifelse(data2018$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2018$STATEICP==6, "Vermont", ifelse(data2018$STATEICP==11, "Delaware", ifelse(data2018$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2018$STATEICP==13, "New York", ifelse(data2018$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2018$STATEICP==21, "Illinois", ifelse(data2018$STATEICP==22, "Indiana", ifelse(data2018$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2018$STATEICP==24, "Ohio", ifelse(data2018$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2018$STATEICP==31, "Iowa", ifelse(data2018$STATEICP==32, "Kansas", ifelse(data2018$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2018$STATEICP==34, "Missouri", ifelse(data2018$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2018$STATEICP==36, "North Dakota", ifelse(data2018$STATEICP==37, "South Dakota", ifelse(data2018$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2018$STATEICP==41, "Alabama", ifelse(data2018$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2018$STATEICP==43, "Florida", ifelse(data2018$STATEICP==44, "Georgia", ifelse(data2018$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2018$STATEICP==46, "Mississippi", ifelse(data2018$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2018$STATEICP==48, "South Carolina", ifelse(data2018$STATEICP==49, "Texas", ifelse(data2018$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2018$STATEICP==52, "Maryland", ifelse(data2018$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2018$STATEICP==54, "Tennessee", ifelse(data2018$STATEICP==56, "West Virginia", ifelse(data2018$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2018$STATEICP==62, "Colorado", ifelse(data2018$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2018$STATEICP==64, "Montana", ifelse(data2018$STATEICP==65, "Nevada", ifelse(data2018$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2018$STATEICP==67, "Utah", ifelse(data2018$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2018$STATEICP==71, "California", ifelse(data2018$STATEICP==72, "Oregon", ifelse(data2018$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2018$STATEICP==81, "Alaska", ifelse(data2018$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2018 <- data2018 %>% filter(STATEICP > 0)

data2019$STATEICP <- ifelse(data2019$STATEICP==1, "Connecticut", ifelse(data2019$STATEICP==2, "Maine", ifelse(data2019$STATEICP==3,
                                                                                                              "Massachusetts", ifelse(data2019$STATEICP==4, "New Hampshire", ifelse(data2019$STATEICP==5, "Rhode Island", 
                                                                                                                                                                                    ifelse(data2019$STATEICP==6, "Vermont", ifelse(data2019$STATEICP==11, "Delaware", ifelse(data2019$STATEICP==12,
                                                                                                                                                                                                                                                                             "New Jersey", ifelse(data2019$STATEICP==13, "New York", ifelse(data2019$STATEICP==14, "Pennsylvania", 
                                                                                                                                                                                                                                                                                                                                            ifelse(data2019$STATEICP==21, "Illinois", ifelse(data2019$STATEICP==22, "Indiana", ifelse(data2019$STATEICP==23,
                                                                                                                                                                                                                                                                                                                                                                                                                                      "Michigan", ifelse(data2019$STATEICP==24, "Ohio", ifelse(data2019$STATEICP==25, "Wisconsin", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ifelse(data2019$STATEICP==31, "Iowa", ifelse(data2019$STATEICP==32, "Kansas", ifelse(data2019$STATEICP==33,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "Minnesota", ifelse(data2019$STATEICP==34, "Missouri", ifelse(data2019$STATEICP==35, "Nebraska", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2019$STATEICP==36, "North Dakota", ifelse(data2019$STATEICP==37, "South Dakota", ifelse(data2019$STATEICP==40,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     "Virginia", ifelse(data2019$STATEICP==41, "Alabama", ifelse(data2019$STATEICP==42, "Arkansas", 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ifelse(data2019$STATEICP==43, "Florida", ifelse(data2019$STATEICP==44, "Georgia", ifelse(data2019$STATEICP==45,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "Lousiana", ifelse(data2019$STATEICP==46, "Mississippi", ifelse(data2019$STATEICP==47, "North Carolina",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ifelse(data2019$STATEICP==48, "South Carolina", ifelse(data2019$STATEICP==49, "Texas", ifelse(data2019$STATEICP==51,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Kentucky", ifelse(data2019$STATEICP==52, "Maryland", ifelse(data2019$STATEICP==53, "Oklahoma",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2019$STATEICP==54, "Tennessee", ifelse(data2019$STATEICP==56, "West Virginia", ifelse(data2019$STATEICP==61,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      "Arizona", ifelse(data2019$STATEICP==62, "Colorado", ifelse(data2019$STATEICP==63, "Idaho",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ifelse(data2019$STATEICP==64, "Montana", ifelse(data2019$STATEICP==65, "Nevada", ifelse(data2019$STATEICP==66,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          "New Mexico", ifelse(data2019$STATEICP==67, "Utah", ifelse(data2019$STATEICP==68, "Wyoming",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     ifelse(data2019$STATEICP==71, "California", ifelse(data2019$STATEICP==72, "Oregon", ifelse(data2019$STATEICP==73,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Washington", ifelse(data2019$STATEICP==81, "Alaska", ifelse(data2019$STATEICP==82, "Hawaii", 0))))))))))))))))))))))))))))))))))))))))))))))))))
data2019 <- data2019 %>% filter(STATEICP > 0)

### Summarizing per state and year
data2002 <- data2002 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2003 <- data2003 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2004 <- data2004 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2005 <- data2005 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2006 <- data2006 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2007 <- data2007 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2008 <- data2008 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2009 <- data2009 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2010 <- data2010 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2011 <- data2011 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2012 <- data2012 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2013 <- data2013 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2014 <- data2014 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2015 <- data2015 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2016 <- data2016 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2017 <- data2017 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2018 <- data2018 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))
data2019 <- data2019 %>% group_by(STATEICP) %>% summarize(avg_age = mean(AGE), avg_ed = mean(EDUC), avg_in = mean(INCTOT), per_fem = mean(fem), per_hisp = mean(HISPAN), per_white = mean(White), per_black = mean(Black), per_native = mean(Native), per_asian = mean(Asian))

#renaming state columns
data2002 <- data2002 %>% rename("state" = "State")
data2003 <- data2003 %>% rename("state" = "State")
data2004 <- data2004 %>% rename("state" = "State")
data2005 <- data2005 %>% rename("state" = "State")
data2006 <- data2006 %>% rename("state" = "State")
data2007 <- data2007 %>% rename("state" = "State")
data2008 <- data2008 %>% rename("state" = "State")
data2009 <- data2009 %>% rename("state" = "State")
data2010 <- data2010 %>% rename("state" = "State")
data2011 <- data2011 %>% rename("state" = "State")
data2012 <- data2012 %>% rename("state" = "State")
data2013 <- data2013 %>% rename("state" = "State")
data2014 <- data2014 %>% rename("state" = "State")
data2015 <- data2015 %>% rename("state" = "State")
data2016 <- data2016 %>% rename("state" = "State")
data2017 <- data2017 %>% rename("state" = "State")
data2018 <- data2018 %>% rename("state" = "State")
data2019 <- data2019 %>% rename("state" = "State")

########### Working on Data 1
data1 <- data1 %>% separate(month, c('Year', 'month')) #separate dates
data1 <- data1 %>% filter(Year > 2001) %>% filter(Year < 2020) #filter out years
data1 <- data1 %>% filter(!(state == "Guam"))
data1 <- data1 %>% filter(!(state == "District of Columbia"))
data1 <- data1 %>% filter(!(state == "Mariana Islands"))
data1 <- data1 %>% filter(!(state == "Puerto Rico"))
data1 <- data1 %>% filter(!(state == "Virgin Islands"))

data1 <- data1 %>% select(Year, state, permit, handgun, long_gun, totals)

#Making separate dfs
guns2002 <- data1 %>% filter(Year==2002)
guns2003 <- data1 %>% filter(Year==2003)
guns2004 <- data1 %>% filter(Year==2004)
guns2005 <- data1 %>% filter(Year==2005)
guns2006 <- data1 %>% filter(Year==2006)
guns2007 <- data1 %>% filter(Year==2007)
guns2008 <- data1 %>% filter(Year==2008)
guns2009 <- data1 %>% filter(Year==2009)
guns2010 <- data1 %>% filter(Year==2010)
guns2011 <- data1 %>% filter(Year==2011)
guns2012 <- data1 %>% filter(Year==2012)
guns2013 <- data1 %>% filter(Year==2013)
guns2014 <- data1 %>% filter(Year==2014)
guns2015 <- data1 %>% filter(Year==2015)
guns2016 <- data1 %>% filter(Year==2016)
guns2017 <- data1 %>% filter(Year==2017)
guns2018 <- data1 %>% filter(Year==2018)
guns2019 <- data1 %>% filter(Year==2019)

#Summarizizng into years
guns2002 <- guns2002 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2003 <- guns2003 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2004 <- guns2004 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2005 <- guns2005 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2006 <- guns2006 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2007 <- guns2007 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2008 <- guns2008 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2009 <- guns2009 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2010 <- guns2010 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2011 <- guns2011 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2012 <- guns2012 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2013 <- guns2013 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2014 <- guns2014 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2015 <- guns2015 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2016 <- guns2016 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2017 <- guns2017 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2018 <- guns2018 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )
guns2019 <- guns2019 %>% group_by(state) %>% summarize(permits = sum(permit), handguns = sum(handgun), long_guns = sum(long_gun), bg_check = sum(totals) )

#Joining dfs
d2 <- left_join(guns2002, data2002, by = "state")
d3 <- left_join(guns2003, data2003, by = "state")
d4 <- left_join(guns2004, data2004, by = "state")
d5 <- left_join(guns2005, data2005, by = "state")
d6 <- left_join(guns2006, data2006, by = "state")
d7 <- left_join(guns2007, data2007, by = "state")
d8 <- left_join(guns2008, data2008, by = "state")
d9 <- left_join(guns2009, data2009, by = "state")
d10 <- left_join(guns2010, data2010, by = "state")
d11 <- left_join(guns2011, data2011, by = "state")
d12 <- left_join(guns2012, data2012, by = "state")
d13 <- left_join(guns2013, data2013, by = "state")
d14 <- left_join(guns2014, data2014, by = "state")
d15 <- left_join(guns2015, data2015, by = "state")
d16 <- left_join(guns2016, data2016, by = "state")
d17 <- left_join(guns2017, data2017, by = "state")
d18 <- left_join(guns2018, data2018, by = "state")
d19 <- left_join(guns2019, data2019, by = "state")

d2 <- d2 %>% mutate(newcol = 2002)
d3 <- d3 %>% mutate(newcol = 2003)
d4 <- d4 %>% mutate(newcol = 2004)
d5 <- d5 %>% mutate(newcol = 2005)
d6 <- d6 %>% mutate(newcol = 2006)
d7 <- d7 %>% mutate(newcol = 2007)
d8 <- d8 %>% mutate(newcol = 2008)
d9 <- d9 %>% mutate(newcol = 2009)
d10 <- d10 %>% mutate(newcol = 2010)
d11 <- d11 %>% mutate(newcol = 2011)
d12 <- d12 %>% mutate(newcol = 2012)
d13 <- d13 %>% mutate(newcol = 2013)
d14 <- d14 %>% mutate(newcol = 2014)
d15 <- d15 %>% mutate(newcol = 2015)
d16 <- d16 %>% mutate(newcol = 2016)
d17 <- d17 %>% mutate(newcol = 2017)
d18 <- d18 %>% mutate(newcol = 2018)
d19 <- d19 %>% mutate(newcol = 2019)

#Joining into one df
data <- rbind(d2, d3, d4, d5, d6, d7, d8, d9, d10, d11, d12, d13, d14, d15, d16, d17, d18, d19)

#Deleting old dfs
rm(d2, d3, d4, d5, d6, d7, d8, d9, d10, d11, d12, d13, d14, d15, d16, d17, d18, d19)
rm(data2002, data2003, data2004, data2005, data2006, data2007, data2008, data2009, data2010, data2011, data2012, data2013, data2014, data2015, data2016, data2017, data2018, data2019)
rm(guns2002, guns2003, guns2004, guns2005, guns2006, guns2007, guns2008, guns2009, guns2010, guns2011, guns2012, guns2013, guns2014, guns2015, guns2016, guns2017, guns2018, guns2019)

#rounding data
data$avg_age <- round(data$avg_age)
data$avg_ed <- round(data$avg_ed, digits = 1)
data$avg_in <- round(data$avg_in)
data$per_fem <- round(data$per_fem, digits = 2)
data$per_fem <- data$per_fem * 100

data$per_white <- data$per_white / 100
data$per_black <- data$per_black * 100
data$per_native <- data$per_native * 100
data$per_asian <- data$per_asian * 100
data$per_hisp <- data$per_hisp * 100

data$per_white <- round(data$per_white, digits = 1)
data$per_black <- round(data$per_black, digits = 1)
data$per_native <- round(data$per_native, digits = 1)
data$per_asian <- round(data$per_asian, digits = 1)
data$per_hisp <- round(data$per_hisp, digits = 1)

data <- data %>% rename("year" = "newcol")

data <- data[,c(15,1,2,3,4,5,6,7,8,9,10,11,12,13,14)]

write.csv(data, file="data875.csv")

###For descriptive stats
#Census dataset
data3 <- rbind(data2002, data2003, data2004, data2005, data2006, data2007, data2008, data2009, data2010, data2011, data2012, data2013, data2014, data2015, data2016, data2017, data2018, data2019)
summary(data3)
#Guns dataset
data4 <- rbind(guns2002, guns2003, guns2004, guns2005, guns2006, guns2007, guns2008, guns2009, guns2010, guns2011, guns2012, guns2013, guns2014, guns2015, guns2016, guns2017, guns2018, guns2019)
data4$total_gun <- data4$handguns + data4$long_guns
summary(data4)

###Two new datasets
data875$total_gun <- data875$handguns + data875$long_guns
data875 <- data875 %>% filter(!(state == "Louisiana"))

data_year <- data875 %>% group_by(year) %>% summarize(permits = sum(permits, na.rm=TRUE), handguns = sum(handguns), long_guns = sum(long_guns), total_gun = sum(total_gun), bg_check = sum(bg_check), avg_age = mean(avg_age), avg_ed = mean(avg_ed), avg_in = mean(avg_in), per_fem = mean(per_fem), per_hisp = mean(per_hisp), per_white = mean(per_white), per_black = mean(per_black), per_nat = mean(per_native), per_asian = mean(per_asian))

data_year$avg_ed <- round(data_year$avg_ed, digits = 1)
data_year$avg_age <- round(data_year$avg_age, digits = 1)
data_year$avg_in <- round(data_year$avg_in, digits = 1)
data_year$per_fem <- round(data_year$per_fem, digits = 1)
data_year$per_hisp <- round(data_year$per_hisp, digits = 1)
data_year$per_white <- round(data_year$per_white, digits = 1)
data_year$per_black <- round(data_year$per_black, digits = 1)
data_year$per_nat <- round(data_year$per_nat, digits = 1)
data_year$per_asian <- round(data_year$per_asian, digits = 1)

data_state <- data875 %>% group_by(state) %>% summarize(permits = sum(permits, na.rm=TRUE), handguns = sum(handguns), long_guns = sum(long_guns), total_gun = sum(total_gun), bg_check = sum(bg_check), avg_age = mean(avg_age), avg_ed = mean(avg_ed), avg_in = mean(avg_in), per_fem = mean(per_fem), per_hisp = mean(per_hisp), per_white = mean(per_white), per_black = mean(per_black), per_nat = mean(per_native), per_asian = mean(per_asian))

data_state$avg_ed <- round(data_state$avg_ed, digits = 1)
data_state$avg_age <- round(data_state$avg_age, digits = 1)
data_state$avg_in <- round(data_state$avg_in, digits = 1)
data_state$per_fem <- round(data_state$per_fem, digits = 1)
data_state$per_hisp <- round(data_state$per_hisp, digits = 1)
data_state$per_white <- round(data_state$per_white, digits = 1)
data_state$per_black <- round(data_state$per_black, digits = 1)
data_state$per_nat <- round(data_state$per_nat, digits = 1)
data_state$per_asian <- round(data_state$per_asian, digits = 1)  

#Creating the 2 dfs
write.csv(data_year, file="data_year.csv")
write.csv(data_state, file="data_state.csv")


####################### Final Project

## Adding urbanization index
data875$urb <- ifelse(data875$state == "New York", 12.56, ifelse(data875$state == "New Jersey", 12.24, ifelse(data875$state == "California", 12.19, ifelse(data875$state == "Massachusetts", 11.84, ifelse(data875$state == "Nevada", 11.77, ifelse(data875$state == "Rhode Island", 11.72, ifelse(data875$state == "Maryland", 11.71, ifelse(data875$state == "Illinois", 11.62, ifelse(data875$state == "Florida", 11.46, ifelse(data875$state == "Connecticut", 11.41, ifelse(data875$state == "Arizona", 11.30, ifelse(data875$state == "Texas", 11.17, ifelse(data875$state == "Colorado", 11.15, ifelse(data875$state == "Pennsylvania", 11.15, ifelse(data875$state == "Washington", 11.12, ifelse(data875$state == "Hawaii", 11.09, ifelse(data875$state == "Delaware", 11.01, ifelse(data875$state == "Utah", 10.96, ifelse(data875$state == "Virginia", 10.91, ifelse(data875$state == "Ohio", 10.88, ifelse(data875$state == "Michigan", 10.81, ifelse(data875$state == "Oregon", 10.71, ifelse(data875$state == "Georgia", 10.55, ifelse(data875$state == "Minnesota", 10.46, ifelse(data875$state == "Indiana", 10.41, ifelse(data875$state == "North Carolina", 10.32, ifelse(data875$state == "Missouri", 10.20, ifelse(data875$state == "Nebraska", 10.20, ifelse(data875$state == "Tennessee", 10.20, ifelse(data875$state == "Wisconsin", 10.19, ifelse(data875$state == "Lousiana", 10.18, ifelse(data875$state == "Kansas", 10.12, ifelse(data875$state == "South Carolina", 10.11, ifelse(data875$state == "Oklahoma", 9.94, ifelse(data875$state == "New Hampshire", 9.92, ifelse(data875$state == "New Mexico", 9.90, ifelse(data875$state == "Kentucky", 9.79, ifelse(data875$state == "Alabama", 9.61, ifelse(data875$state == "Idaho", 9.59, ifelse(data875$state == "Iowa", 9.59, ifelse(data875$state == "Arkansas", 9.26, ifelse(data875$state == "West Virginia", 9.11, ifelse(data875$state == "North Dakota", 9.05, ifelse(data875$state == "Maine", 9.04, ifelse(data875$state == "Mississippi", 8.91, ifelse(data875$state == "Vermont", 8.84, ifelse(data875$state == "Alaska", 8.74, ifelse(data875$state == "South Dakota", 8.73, ifelse(data875$state == "Montana", 8.47, ifelse(data875$state == "Wyoming", 8.26, 0))))))))))))))))))))))))))))))))))))))))))))))))))
data_state$urb <- ifelse(data_state$state == "New York", 12.56, ifelse(data_state$state == "New Jersey", 12.24, ifelse(data_state$state == "California", 12.19, ifelse(data_state$state == "Massachusetts", 11.84, ifelse(data_state$state == "Nevada", 11.77, ifelse(data_state$state == "Rhode Island", 11.72, ifelse(data_state$state == "Maryland", 11.71, ifelse(data_state$state == "Illinois", 11.62, ifelse(data_state$state == "Florida", 11.46, ifelse(data_state$state == "Connecticut", 11.41, ifelse(data_state$state == "Arizona", 11.30, ifelse(data_state$state == "Texas", 11.17, ifelse(data_state$state == "Colorado", 11.15, ifelse(data_state$state == "Pennsylvania", 11.15, ifelse(data_state$state == "Washington", 11.12, ifelse(data_state$state == "Hawaii", 11.09, ifelse(data_state$state == "Delaware", 11.01, ifelse(data_state$state == "Utah", 10.96, ifelse(data_state$state == "Virginia", 10.91, ifelse(data_state$state == "Ohio", 10.88, ifelse(data_state$state == "Michigan", 10.81, ifelse(data_state$state == "Oregon", 10.71, ifelse(data_state$state == "Georgia", 10.55, ifelse(data_state$state == "Minnesota", 10.46, ifelse(data_state$state == "Indiana", 10.41, ifelse(data_state$state == "North Carolina", 10.32, ifelse(data_state$state == "Missouri", 10.20, ifelse(data_state$state == "Nebraska", 10.20, ifelse(data_state$state == "Tennessee", 10.20, ifelse(data_state$state == "Wisconsin", 10.19, ifelse(data_state$state == "Lousiana", 10.18, ifelse(data_state$state == "Kansas", 10.12, ifelse(data_state$state == "South Carolina", 10.11, ifelse(data_state$state == "Oklahoma", 9.94, ifelse(data_state$state == "New Hampshire", 9.92, ifelse(data_state$state == "New Mexico", 9.90, ifelse(data_state$state == "Kentucky", 9.79, ifelse(data_state$state == "Alabama", 9.61, ifelse(data_state$state == "Idaho", 9.59, ifelse(data_state$state == "Iowa", 9.59, ifelse(data_state$state == "Arkansas", 9.26, ifelse(data_state$state == "West Virginia", 9.11, ifelse(data_state$state == "North Dakota", 9.05, ifelse(data_state$state == "Maine", 9.04, ifelse(data_state$state == "Mississippi", 8.91, ifelse(data_state$state == "Vermont", 8.84, ifelse(data_state$state == "Alaska", 8.74, ifelse(data_state$state == "South Dakota", 8.73, ifelse(data_state$state == "Montana", 8.47, ifelse(data_state$state == "Wyoming", 8.26, 0))))))))))))))))))))))))))))))))))))))))))))))))))

## Adding regions
data875$region <- ifelse(data875$state =="Washington", "West", ifelse(data875$state == "Oregon", "West", ifelse(data875$state == "California", "West", ifelse(data875$state == "Arizona", "West", ifelse(data875$state=="New Mexico", "West", ifelse(data875$state=="Colorado", "West", ifelse(data875$state=="Nevada", "West", ifelse(data875$state=="Utah", "West", ifelse(data875$state=="Idaho", "West", ifelse(data875$state=="Montana", "West", ifelse(data875$state=="Wyoming", "West", ifelse(data875$state == "North Dakota", "Midwest", ifelse(data875$state=="South Dakota", "Midwest", ifelse(data875$state=="Nebraska", "Midwest", ifelse(data875$state=="Kansas", "Midwest", ifelse(data875$state=="Minnesota", "Midwest", ifelse(data875$state=="Iowa", "Midwest", ifelse(data875$state=="Missouri", "Midwest", ifelse(data875$state=="Wisconsin", "Midwest", ifelse(data875$state=="Illinois", "Midwest", ifelse(data875$state=="Indiana", "Midwest", ifelse(data875$state=="Michigan", "Midwest", ifelse(data875$state=="Ohio", "Midwest", ifelse(data875$state == "Maine", "Northeast", ifelse(data875$state=="Vermont", "Northeast", ifelse(data875$state=="New Hampshire", "Northeast", ifelse(data875$state=="Connecticut", "Northeast", ifelse(data875$state=="New York", "Northeast", ifelse(data875$state=="Massachusetts", "Northeast", ifelse(data875$state=="Pennsylvania", "Northeast", ifelse(data875$state=="Rhode Island", "Northeast", ifelse(data875$state=="New Jersey", "Northeast", "South"))))))))))))))))))))))))))))))))
data_state$region <-ifelse(data_state$state =="Washington", "West", ifelse(data_state$state == "Oregon", "West", ifelse(data_state$state == "California", "West", ifelse(data_state$state == "Arizona", "West", ifelse(data_state$state=="New Mexico", "West", ifelse(data_state$state=="Colorado", "West", ifelse(data_state$state=="Nevada", "West", ifelse(data_state$state=="Utah", "West", ifelse(data_state$state=="Idaho", "West", ifelse(data_state$state=="Montana", "West", ifelse(data_state$state=="Wyoming", "West", ifelse(data_state$state == "North Dakota", "Midwest", ifelse(data_state$state=="South Dakota", "Midwest", ifelse(data_state$state=="Nebraska", "Midwest", ifelse(data_state$state=="Kansas", "Midwest", ifelse(data_state$state=="Minnesota", "Midwest", ifelse(data_state$state=="Iowa", "Midwest", ifelse(data_state$state=="Missouri", "Midwest", ifelse(data_state$state=="Wisconsin", "Midwest", ifelse(data_state$state=="Illinois", "Midwest", ifelse(data_state$state=="Indiana", "Midwest", ifelse(data_state$state=="Michigan", "Midwest", ifelse(data_state$state=="Ohio", "Midwest", ifelse(data_state$state == "Maine", "Northeast", ifelse(data_state$state=="Vermont", "Northeast", ifelse(data_state$state=="New Hampshire", "Northeast", ifelse(data_state$state=="Connecticut", "Northeast", ifelse(data_state$state=="New York", "Northeast", ifelse(data_state$state=="Massachusetts", "Northeast", ifelse(data_state$state=="Pennsylvania", "Northeast", ifelse(data_state$state=="Rhode Island", "Northeast", ifelse(data_state$state=="New Jersey", "Northeast", "South")))))))))))))))))))))))))))))))) 

## Adding Historical politcal info
data875$pol <- ifelse(data875$state== "Massachussets", "Blue", ifelse(data875$state=="Hawaii", "Blue", ifelse(data875$state=="Vermont", "Blue", ifelse(data875$state=="Maryland", "Blue", ifelse(data875$state=="California", "Blue", ifelse(data875$state=="Rhode Island", "Blue", ifelse(data875$state=="New York", "Blue", ifelse(data875$state=="Delaware", "Blue", ifelse(data875$state=="Illinois", "Blue", ifelse(data875$state=="Washington", "Blue", ifelse(data875$state=="Connecticut", "Blue", ifelse(data875$state=="New Jersey", "Blue", ifelse(data875$state=="Oregon", "Blue", ifelse(data875$state=="New Mexico", "Blue", ifelse(data875$state=="Colorado", "Blue", ifelse(data875$state=="Virginia", "Blue", ifelse(data875$state=="Maine", "Blue", ifelse(data875$state=="Minnesota", "Purple", ifelse(data875$state=="New Hampshire", "Purple", ifelse(data875$state=="Michigan", "Purple", ifelse(data875$state=="Nevada", "Purple", ifelse(data875$state=="Pennsylvania", "Purple", "Red"))))))))))))))))))))))
data_state$pol <- ifelse(data_state$state== "Massachussets", "Blue", ifelse(data_state$state=="Hawaii", "Blue", ifelse(data_state$state=="Vermont", "Blue", ifelse(data_state$state=="Maryland", "Blue", ifelse(data_state$state=="California", "Blue", ifelse(data_state$state=="Rhode Island", "Blue", ifelse(data_state$state=="New York", "Blue", ifelse(data_state$state=="Delaware", "Blue", ifelse(data_state$state=="Illinois", "Blue", ifelse(data_state$state=="Washington", "Blue", ifelse(data_state$state=="Connecticut", "Blue", ifelse(data_state$state=="New Jersey", "Blue", ifelse(data_state$state=="Oregon", "Blue", ifelse(data_state$state=="New Mexico", "Blue", ifelse(data_state$state=="Colorado", "Blue", ifelse(data_state$state=="Virginia", "Blue", ifelse(data_state$state=="Maine", "Blue", ifelse(data_state$state=="Minnesota", "Purple", ifelse(data_state$state=="New Hampshire", "Purple", ifelse(data_state$state=="Michigan", "Purple", ifelse(data_state$state=="Nevada", "Purple", ifelse(data_state$state=="Pennsylvania", "Purple", "Red"))))))))))))))))))))))

data875$total_gun <- data875$handguns + data875$long_guns
data875 <- data875 %>% filter(!(state=="Louisiana"))

write.csv(data_year, file="data_year.csv")
write.csv(data875, file="data875.csv")

################## Graphs
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(ggridges)
library(GGally)

install.packages("ggplot2", verbose = T)
install.packages("ggthemes", verbose = T)
install.packages("expss", verbose = T)
install.packages("tidyr")
install.packages("fabricatr", verbose = T)
install.packages("coefplot", verbose = T)
install.packages("RColorBrewer", verbose = T)
install.packages("ggridges")
install.packages("GGally")

# Education explains gun sales and income
ggplot(data875, aes(avg_in, total_gun, colour = avg_ed)) + 
  geom_point(size=4) + labs(title="Average Income, Total Gun Sales, and Average Education", colour="Average Education", x="Average Income", y="Total Firearm Sales")

# Political leaning explains sales and education
ggplot(data875, aes(x=avg_ed, y=total_gun, color=pol)) + geom_point(size=4) + scale_color_manual(values=c("#1D3CC6", "#C000E3", "#E30000")) +
  labs(title="Total Firearm Sales, Average Education, and Political Leaning", x="Average Education", y="Total Firearm Sales", color="Political Leaning") +
  theme(plot.title = element_text(size=18))


ggplot(data875, aes(x=avg_in, y=total_gun, color=region)) + geom_point()
ggplot(data875, aes(x=urb, y=total_gun, color=region)) + geom_point(size=4) + 
  labs(title="Urbanization Index, Regions, and Firearm Sales", x="Urbanization Index", y="Total Firearm Sales", color="Regions")


data875_ns <- data875 %>% select(urb, avg_ed, avg_in, permits, bg_check, total_gun)
ggpairs(data875_ns)

